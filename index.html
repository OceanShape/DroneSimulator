<!doctype html>
<html>
<head>
	<title>XDWorldEM</title>
	<script type="importmap">
        {
            "imports": {
				"GLTFLoader": "https://unpkg.com/three@0.138.0/examples/jsm/loaders/GLTFLoader.js",
                "three": "https://unpkg.com/three@0.141.0/build/three.module.js",
				"OrbitControls": "https://unpkg.com/three@0.141.0/examples/jsm/controls/OrbitControls.js"
            }
        }
    </script>
</head>
<body>
	<script>
		const Mode = {
			SELECT: "Select",
			DRIVING: "Driving",
		};

		let GLOBAL = {
			engineDirectory: "./engine/",
			currentMode: Mode.SELECT,
			drivingModePath: "./driving.html",
			selectModePath: "./select.html",
			startPOIImagePath: "./data/start.png",
			endPOIImagePath: "./data/end.png",
			camera: null,
			POICount: 0,
			layerList: null,
			images: null,
			POIPosition: null,
			isAllPOISet: false,
			isGhostSymbolLoaded: false,
			droneToTargetDirection: 0.0,
			droneDelta: 2,
			radius: 30,
			keys: [],
			TRACE_TARGET: null,
			isTraceActive: true,
			MOUSE_BUTTON_PRESS: true,
		};
		Object.freeze(Mode);

		function getDronePosition() {
			let drone = GLOBAL.layerList
				.nameAtLayer("GHOST_SYMBOL_LAYER")
				.getObjects()[0].object;
			return drone.getPosition();
		}

		function getDirection() {
			let st = getDronePosition();
			let ed = GLOBAL.POIPosition[1];
			let direction = getDegree(Math.atan2(ed.Latitude - st.Latitude, ed.Longitude - st.Longitude));

			let d = 90 - direction;
			if (0 < direction && direction < 90) {
				d = 84.5 - direction;
			} else if (90 < direction && direction < 180) {
				d = 454 - direction;
			} else if (-180 < direction && direction < -90) {
				d = 346 + direction;
			} else if (-90 < direction && direction < 0) {
				d = 454 - direction;
			}
			return d;
		}

		function getDegree(radian) {
			return (radian * 180) / Math.PI;
		}

		function getRadians(degrees) {
 		   return (degrees * Math.PI) / 180;
		}
	</script>
	<script src="common.js"></script>
	<script src="select.js"></script>
	<script src="driving.js"></script>
	<script src="init.js"></script>
	<script type="module" src="model-loader.js"></script>
	<div class="include-html" style="position: absolute; background-color: white; opacity: 0.9; border-radius: 10px; margin: 10px; padding: 15px;"></div>
	<canvas id="model-loader" style="position: fixed; right: 10px; top: -40px; width: 500px; height: 500px;"></canvas>
</body>
</html>
